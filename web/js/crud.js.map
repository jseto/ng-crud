{"version":3,"file":"web/js/crud.min.js","sources":["src/clt/crud.module.js","src/clt/CrudController.js","src/clt/CrudDirectives.js","src/clt/CrudFilters.js","src/clt/CrudService.js"],"names":["angular","module","controller","$scope","$http","$route","$location","paths","current","originalPath","split","collection","collInfo","crudMetadata","action","console","log","item","get","success","data","$parent","items","params","id","Error","httpAction","verb","extraPath","toUpperCase","path","error","status","headers","config","doSubmit","doDelete","modalId","$","on","toDelete","undefined","_id","reload","prepareDelete","idx","directive","restrict","scope","formInputScope","link","formInputLink","template","formInputHeader","formInputFooter","element","attrs","fieldMeta","$eval","listModel","templateUrl","$compile","tag","inputType","html","inputAttrs","prop","hasOwnProperty","append","label","placeholder","model","autofocus","inputElement","find","setTimeout","focus","attr","filter","crud","singularize","provider","this","$get","completeMetadataDefaults","routesForCollection","metadata","collName","collMeta","tableName","ucFirst","itemName","fieldOrder","Object","keys","fields","i","length","completeFieldDefaults","name","field","colLabel","cellRender","identity","showInTable","x","str","charAt","substr","plural","toLowerCase","irregulars","mice","teeth","singular","warn","$routeProvider","ctrl","when"],"mappings":"CAAA,WACCA,QAAQC,OAAO,QACb,UAAW,oBCFd,WACCD,QAAQC,OAAO,QAEdC,WAAW,YAAa,SAAU,QAAS,SAAU,YACrD,SAASC,OAAQC,MAAOC,OAAQC,WAChC,GAAIC,OAAQF,OAAOG,QAAQC,aAAaC,MAAM,IAC9CP,QAAOQ,WAAaN,OAAOG,QAAQG,YAAcJ,MAAM,EACvDJ,QAAOS,SAAWT,OAAOU,aAAaV,OAAOQ,WAC7CR,QAAOW,OAAST,OAAOG,QAAQM,QAAUP,MAAM,IAAM,MACrDQ,SAAQC,IAAI,cAAeb,OAAOQ,WAAY,cAAeR,OAAOW,OACpE,QAAQX,OAAOW,QACd,IAAK,SACJX,OAAOc,OACP,MACD,KAAK,OACJb,MAAMc,IAAI,SAAWf,OAAOQ,YAC3BQ,QAAQ,SAASC,MACjBjB,OAAOkB,QAAQC,MAAQF,KAAKE,OAE7B,MACD,KAAK,SACJnB,OAAOc,KAAOd,OAAOkB,QAAQC,MAAMjB,OAAOG,QAAQe,OAAOC,GACzD,MACD,SACC,KAAM,IAAIC,OAAM,mBAAqBtB,OAAOW,QAG9C,QAASY,YAAWC,KAAMV,KAAMW,WAC/BA,UAAYA,WAAa,EACzB,OAAOxB,OAAMuB,MAAM,SAAWxB,OAAOQ,WAAaiB,UAAWX,MAC5DE,QAAQ,SAASC,MACjBL,QAAQC,IAAIW,KAAKE,cAAgB,QAAST,KAC1Cd,WAAUwB,KAAK3B,OAAOQ,cAEtBoB,MAAM,SAASX,KAAMY,OAAQC,QAASC,QAEtCnB,QAAQgB,MAAMJ,KAAKE,cAAgB,WAAYT,KAAMY,OAAQC,QAASC,UAIxE/B,OAAOgC,SAAW,WACjB,GAAIR,MAAOxB,OAAOW,QAAU,SAAW,OAAS,KAChDY,YAAWC,KAAMxB,OAAOc,MAGzBd,QAAOiC,SAAW,SAASC,SAC1BC,EAAE,IAAMD,SAASE,GAAG,kBAAmB,WACtCxB,QAAQC,IAAI,YAAab,OAAOqC,SAChCd,YAAW,SAAUe,UAAW,IAAMtC,OAAOqC,SAASE,KACrDvB,QAAQ,WACRd,OAAOsC,aAKVxC,QAAOyC,cAAgB,SAASC,KAC/B1C,OAAOqC,SAAWrC,OAAOkB,QAAQC,MAAMuB,cCxD1C,WACC7C,QAAQC,OAAO,QAId6C,UAAU,YAAa,WACvB,OACCC,SAAU,IACVC,MAAOC,eACPC,KAAMC,cACNC,SAAUC,gBACT,gGACAC,mBAIFR,UAAU,eAAgB,WAC1B,OACCC,SAAU,IACVC,MAAOC,eACPC,KAAMC,cACNC,SAAUC,gBACT,sGACA,cACAC,mBAIFR,UAAU,aAAc,WACxB,OACCC,SAAU,IACVC,MAAOC,eACPC,KAAM,SAASF,MAAOO,QAASC,OAC9BL,cAAcH,MAAOO,QAASC,MAC9B,IAAIC,WAAYT,MAAM3B,QAAQqC,MAAM,yBACpCV,OAAMQ,MAAMhC,GAAK,cAAgBiC,UAAUE,WAE5CP,SAAUC,gBACT,mEACC,4DACD,YACAC,mBAIFR,UAAU,kBAAmB,WAC7B,OACCC,SAAU,IACVK,SACC,2BACC,sCACC,uEACC,iDACD,YACA,SACA,gEACD,SACD,YAIFN,UAAU,YAAa,WACvB,OACCC,SAAU,IACVa,YAAa,+BAKdd,UAAU,iBAAkB,WAAY,SAASe,UACjD,OACCd,SAAU,IACVG,KAAM,SAASF,MAAOO,QAASC,OAC9B,GAAIC,WAAYT,MAAMU,MAAM,yBAC5B,IAAII,KAAML,UAAUM,SACpB,IAAIC,MAAO,IAAMF,IAAM,wBACtB,4CACA,4EACA,+CACD,IAAIG,YAAaR,UAAUQ,UAC3B,KAAK,GAAIC,QAAQD,YAChB,GAAIA,WAAWE,eAAeD,MAC7BF,MAAQ,IAAME,KAAO,KAAOD,WAAWC,MAAQ,GACjDF,OAAQ,MAAQF,IAAM,GACtBP,SAAQa,OAAOP,SAASG,MAAMhB,YASjC,IAAIC,iBACHoB,MAAO,IACPC,YAAa,IACbC,MAAO,IACP/C,GAAI,IACJgD,UAAW,IAGZ,IAAIrB,eAAgB,SAASH,MAAOO,QAASC,OAE5C,GAAIiB,cAAelB,QAAQmB,KAAK,gBAEhC,IAAIlB,MAAMW,eAAe,cAAgBX,MAAMgB,WAAa,QAAS,CAEpEG,WAAW,WAAaF,aAAaG,UAGtC,IAAK,GAAIV,QAAQV,OAChB,GAAIA,MAAMW,eAAeD,OAASA,KAAK,IAAI,MAAQlB,MAAMkB,MACxDO,aAAaI,KAAKX,KAAMV,MAAMU,OAGjC,IAAIb,iBACH,2BACC,6EACC,wBAEH,IAAIC,iBAAkB,oBCxHvB,WACCtD,QAAQC,OAAO,QAEd6E,OAAO,YAAa,OAAQ,SAASC,MACrC,MAAOA,MAAKC,oBCJd,WACChF,QAAQC,OAAO,QAEdgF,SAAS,OAAQ,WACjBC,KAAKC,KAAO,WAEX,OACCC,yBAA0BA,yBAC1BJ,YAAaA,aAKfE,MAAKG,oBAAsBA,qBAO5B,SAASD,0BAAyBE,UACjC,IAAK,GAAIC,YAAYD,UACpB,GAAIA,SAASnB,eAAeoB,UAAW,CAEtC,GAAIC,UAAWF,SAASC,SACxBC,UAAS7E,WAAa4E,QACtB,KAAKC,SAASC,UAAWD,SAASC,UAAYC,QAAQH,SACtD,KAAKC,SAASG,SAAUH,SAASG,SAAWX,YAAYO,SACxD,KAAKC,SAASI,WACbJ,SAASI,WAAaC,OAAOC,KAAKN,SAASO,OAE5C,KAAK,GAAIC,GAAI,EAAGA,EAAIR,SAASI,WAAWK,OAAQD,IAAK,CACpDE,sBAAsBV,SAASO,OAAQP,SAASI,WAAWI,MAK/D,QAASE,uBAAsBH,OAAQI,MACtC,GAAIC,OAAQL,OAAOI,KAEnB,IAAIC,MAAM/B,QAAU5B,UAAW2D,MAAM/B,MAAQqB,QAAQS,KACrD,KAAKC,MAAMrC,UAAWqC,MAAMrC,UAAY,YACxC,KAAKqC,MAAMnC,WAAYmC,MAAMnC,aAE7B,IAAImC,MAAMC,WAAa5D,UAAW2D,MAAMC,SAAWD,MAAM/B,KACzD,KAAK+B,MAAME,WAAYF,MAAME,WAAaC,QAC1C,IAAIH,MAAMI,cAAgB/D,UAAW2D,MAAMI,YAAc,KAG1D,QAASD,UAASE,GAAK,MAAOA,GAE9B,QAASf,SAAQgB,KAChB,MAAOA,KAAIC,OAAO,GAAG9E,cAAgB6E,IAAIE,OAAO,GAGjD,QAAS5B,aAAY6B,QACpBA,OAASA,OAAOC,aAChB,IAAID,OAAOA,OAAOZ,OAAS,IAAM,IAChC,MAAOY,QAAOD,OAAO,EAAGC,OAAOZ,OAAS,EAEzC,IAAIc,aACHC,KAAM,QAASC,MAAO,QAEvB,IAAIC,UAAWH,WAAWF,OAC1B,KAAKK,SACJnG,QAAQoG,KAAK,yBAA0BN,OAAQ,cAChD,OAAOK,UAAWA,SAAWL,OAG9B,QAASxB,qBAAoB+B,eAAgBzG,WAAY0G,MACxDA,KAAOA,MAAQ,UACfD,gBAAeE,KAAK,IAAM3G,YACzBiD,YAAa,iCACb1D,WAAYmH,OAEZC,KAAK,IAAM3G,WAAa,WACxBiD,YAAa,gCACb1D,WAAYmH,OAEZC,KAAK,IAAM3G,WAAa,eACxBiD,YAAa,gCACb1D,WAAYmH","sourcesContent":["(function() {\r\n\tangular.module('crud',\r\n\t\t['ngRoute', 'ngSanitize']\r\n\t);\r\n})();","(function() {\r\n\tangular.module('crud')\r\n\r\n\t.controller('CrudCtrl', ['$scope', '$http', '$route', '$location',\r\n\t\tfunction($scope, $http, $route, $location) {\r\n\t\tvar paths = $route.current.originalPath.split('/');\r\n\t\t$scope.collection = $route.current.collection || paths[1];\r\n\t\t$scope.collInfo = $scope.crudMetadata[$scope.collection];\r\n\t\t$scope.action = $route.current.action || paths[2] || 'read';\r\n\t\tconsole.log('Collection:', $scope.collection, ' -  Action:', $scope.action);\r\n\t\tswitch ($scope.action) {\r\n\t\t\tcase 'create':\r\n\t\t\t\t$scope.item = {};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'read':\r\n\t\t\t\t$http.get('/data/' + $scope.collection)\r\n\t\t\t\t.success(function(data) {\r\n\t\t\t\t\t$scope.$parent.items = data.items;\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'update':\r\n\t\t\t\t$scope.item = $scope.$parent.items[$route.current.params.id];\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error('Invalid action: ' + $scope.action);\r\n\t\t}\r\n\r\n\t\tfunction httpAction(verb, item, extraPath) {\r\n\t\t\textraPath = extraPath || '';\r\n\t\t\treturn $http[verb]('/data/' + $scope.collection + extraPath, item)\r\n\t\t\t.success(function(data) {\r\n\t\t\t\tconsole.log(verb.toUpperCase() + ' OK: ', data);\r\n\t\t\t\t$location.path($scope.collection);\r\n\t\t\t})\r\n\t\t\t.error(function(data, status, headers, config) {\r\n\t\t\t\t//TODO report error to end user\r\n\t\t\t\tconsole.error(verb.toUpperCase() + ' Error: ', data, status, headers, config);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$scope.doSubmit = function() {\r\n\t\t\tvar verb = $scope.action == 'create' ? 'post' : 'put';\r\n\t\t\thttpAction(verb, $scope.item);\r\n\t\t};\r\n\r\n\t\t$scope.doDelete = function(modalId) {\r\n\t\t\t$('#' + modalId).on('hidden.bs.modal', function() {\r\n\t\t\t\tconsole.log('Deleting ', $scope.toDelete);\r\n\t\t\t\thttpAction('delete', undefined, '/' + $scope.toDelete._id)\r\n\t\t\t\t.success(function() {\r\n\t\t\t\t\t$route.reload();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t$scope.prepareDelete = function(idx) {\r\n\t\t\t$scope.toDelete = $scope.$parent.items[idx];\r\n\t\t};\r\n\r\n\t}])\r\n\r\n\r\n})();","(function() {\r\n\tangular.module('crud')\r\n\r\n\t//------------------------- Directives -------------------------\r\n\r\n\t.directive('crudInput', function() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\tscope: formInputScope,\r\n\t\t\tlink: formInputLink,\r\n\t\t\ttemplate: formInputHeader +\r\n\t\t\t\t'<input ng-model=\"model\" class=\"form-control\" id=\"{{id}}_input\" placeholder=\"{{placeholder}}\">' +\r\n\t\t\t\tformInputFooter\r\n\t\t};\r\n\t})\r\n\r\n\t.directive('crudTextArea', function() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\tscope: formInputScope,\r\n\t\t\tlink: formInputLink,\r\n\t\t\ttemplate: formInputHeader +\r\n\t\t\t\t'<textarea ng-model=\"model\" class=\"form-control\" id=\"{{id}}_textarea\" placeholder=\"{{placeholder}}\">' +\r\n\t\t\t\t'</textarea>' +\r\n\t\t\t\tformInputFooter\r\n\t\t\t};\r\n\t})\r\n\r\n\t.directive('crudSelect', function() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\tscope: formInputScope,\r\n\t\t\tlink: function(scope, element, attrs) {\r\n\t\t\t\tformInputLink(scope, element, attrs);\r\n\t\t\t\tvar fieldMeta = scope.$parent.$eval('collInfo.fields[field]');\r\n\t\t\t\tscope[attrs.id + '_listModel'] = fieldMeta.listModel;\r\n\t\t\t},\r\n\t\t\ttemplate: formInputHeader +\r\n\t\t\t\t'<select ng-model=\"model\" class=\"form-control\" id=\"{{id}}_select\"' +\r\n\t\t\t\t\t'ng-options=\"option.label for option in {{id}}_listModel\">' +\r\n\t\t\t\t'</select>' +\r\n\t\t\t\tformInputFooter\r\n\t\t};\r\n\t})\r\n\r\n\t.directive('crudFormButtons', function() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\ttemplate:\r\n\t\t\t\t'<div class=\"form-group\">' +\r\n\t\t\t\t\t'<div class=\"col-sm-12 text-center\">' +\r\n\t\t\t\t\t\t'<button type=\"button\" class=\"btn btn-primary\" ng-click=\"doSubmit()\">' +\r\n\t\t\t\t\t\t\t\"{{ action == 'create' ? 'Create' : 'Update' }}\" +\r\n\t\t\t\t\t\t'</button>' +\r\n\t\t\t\t\t\t'&nbsp;' +\r\n\t\t\t\t\t\t'<a href=\"#/{{collection}}\" class=\"btn btn-default\">Cancel</a>' +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t'</div>'\r\n\t\t};\r\n\t})\r\n\r\n\t.directive('crudTable', function() {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\ttemplateUrl: 'templates/crud-table.html'\r\n\t\t};\r\n\t})\r\n\r\n\t// Super generic form input that compiles into the specific input as specified in field metadata\r\n\t.directive('crudFormInput', ['$compile', function($compile) {\r\n\t\treturn {\r\n\t\t\trestrict: 'E',\r\n\t\t\tlink: function(scope, element, attrs) {\r\n\t\t\t\tvar fieldMeta = scope.$eval('collInfo.fields[field]');\r\n\t\t\t\tvar tag = fieldMeta.inputType;\r\n\t\t\t\tvar html = '<' + tag + ' id=\"crud_{{field}}\" ' +\r\n\t\t\t\t\t'label=\"{{collInfo.fields[field].label}}\" ' +\r\n\t\t\t\t\t'placeholder=\"{{collInfo.fields[field].placeholder}}\" model=\"item[field]\" ' +\r\n\t\t\t\t\t'autofocus=\"{{ $first ? \\'true\\' : \\'false\\' }}\"';\r\n\t\t\t\tvar inputAttrs = fieldMeta.inputAttrs;\r\n\t\t\t\tfor (var prop in inputAttrs)\r\n\t\t\t\t\tif (inputAttrs.hasOwnProperty(prop))\r\n\t\t\t\t\t\thtml += ' ' + prop + '=\"' + inputAttrs[prop] + '\"';\r\n\t\t\t\thtml += '></' + tag + '>';\r\n\t\t\t\telement.append($compile(html)(scope));\r\n\t\t\t}\r\n\t\t}\r\n\t}])\r\n\r\n\r\n\t//------------------------- Privates -------------------------\r\n\t;\r\n\r\n\tvar formInputScope = {\r\n\t\tlabel: '@',\r\n\t\tplaceholder: '@',\r\n\t\tmodel: '=',\r\n\t\tid: '@',\r\n\t\tautofocus: '@'\r\n\t};\r\n\r\n\tvar formInputLink = function(scope, element, attrs) {\r\n\t\t// Warning: this line requires jQuery, otherwise a manual search would be required\r\n\t\tvar inputElement = element.find('.form-control');\r\n\t\t// Set focus if autofocus attribute is present\r\n\t\tif (attrs.hasOwnProperty('autofocus') && attrs.autofocus != 'false') {\r\n\t\t\t// setTimeout without time parameter defers to after DOM rendering\r\n\t\t\tsetTimeout(function() { inputElement.focus(); });\r\n\t\t}\r\n\t\t// Copy all extra attributes into the input element\r\n\t\tfor (var prop in attrs)\r\n\t\t\tif (attrs.hasOwnProperty(prop) && prop[0]!='$' && !scope[prop])\r\n\t\t\t\tinputElement.attr(prop, attrs[prop]);\r\n\t};\r\n\r\n\tvar formInputHeader =\r\n\t\t'<div class=\"form-group\">' +\r\n\t\t\t'<label for=\"{{id}}-input\" class=\"col-sm-3 control-label\">{{label}}</label>' +\r\n\t\t\t\t'<div class=\"col-sm-9\">';\r\n\r\n\tvar formInputFooter = '</div></div>';\r\n\r\n})();","(function() {\n\tangular.module('crud')\n\n\t.filter('singular', ['crud', function(crud) {\n\t\treturn crud.singularize;\n\t}])\n\n})();","(function() {\r\n\tangular.module('crud')\r\n\r\n\t.provider('crud', function() {\r\n\t\tthis.$get = function() {\r\n\t\t\t// Accessible via 'crud' injected parameter\r\n\t\t\treturn {\r\n\t\t\t\tcompleteMetadataDefaults: completeMetadataDefaults,\r\n\t\t\t\tsingularize: singularize\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// this.* is accessible via 'crudProvider' injected parameter\r\n\t\tthis.routesForCollection = routesForCollection;\r\n\t})\r\n\r\n\r\n\t//------------------------- Privates -------------------------\r\n\t;\r\n\r\n\tfunction completeMetadataDefaults(metadata) {\r\n\t\tfor (var collName in metadata)\r\n\t\t\tif (metadata.hasOwnProperty(collName)) {\r\n\t\t\t\t// Collection defaults\r\n\t\t\t\tvar collMeta = metadata[collName];\r\n\t\t\t\tcollMeta.collection = collName;\r\n\t\t\t\tif (!collMeta.tableName) collMeta.tableName = ucFirst(collName);\r\n\t\t\t\tif (!collMeta.itemName) collMeta.itemName = singularize(collName);\r\n\t\t\t\tif (!collMeta.fieldOrder)\r\n\t\t\t\t\tcollMeta.fieldOrder = Object.keys(collMeta.fields);\r\n\t\t\t\t// Field defaults\r\n\t\t\t\tfor (var i = 0; i < collMeta.fieldOrder.length; i++) {\r\n\t\t\t\t\tcompleteFieldDefaults(collMeta.fields, collMeta.fieldOrder[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\r\n\tfunction completeFieldDefaults(fields, name) {\r\n\t\tvar field = fields[name];\r\n\t\t// Form defaults\r\n\t\tif (field.label === undefined) field.label = ucFirst(name);\r\n\t\tif (!field.inputType) field.inputType = 'crud-input';\r\n\t\tif (!field.inputAttrs) field.inputAttrs = {};\r\n\t\t// Table defaults\r\n\t\tif (field.colLabel === undefined) field.colLabel = field.label;\r\n\t\tif (!field.cellRender) field.cellRender = identity;\r\n\t\tif (field.showInTable === undefined) field.showInTable = true;\r\n\t}\r\n\r\n\tfunction identity(x) { return x }\r\n\r\n\tfunction ucFirst(str) {\r\n\t\treturn str.charAt(0).toUpperCase() + str.substr(1);\r\n\t}\r\n\r\n\tfunction singularize(plural) {\r\n\t\tplural = plural.toLowerCase();\r\n\t\tif (plural[plural.length - 1] == 's')\r\n\t\t\treturn plural.substr(0, plural.length - 1);\r\n\t\t// TODO: complete with most common irregular plurals\r\n\t\tvar irregulars = {\r\n\t\t\tmice: 'mouse', teeth: 'tooth'\r\n\t\t}\r\n\t\tvar singular = irregulars[plural];\r\n\t\tif (!singular)\r\n\t\t\tconsole.warn('Warning: singular of \"', plural, '\" not found');\r\n\t\treturn singular ? singular : plural;\r\n\t}\r\n\r\n\tfunction routesForCollection($routeProvider, collection, ctrl) {\r\n\t\tctrl = ctrl || 'CrudCtrl';\r\n\t\t$routeProvider.when('/' + collection, {\r\n\t\t\ttemplateUrl: 'templates/crud-table-view.html',\r\n\t\t\tcontroller: ctrl\r\n\t\t})\r\n\t\t.when('/' + collection + '/create', {\r\n\t\t\ttemplateUrl: 'templates/crud-form-view.html',\r\n\t\t\tcontroller: ctrl\r\n\t\t})\r\n\t\t.when('/' + collection + '/update/:id', {\r\n\t\t\ttemplateUrl: 'templates/crud-form-view.html',\r\n\t\t\tcontroller: ctrl\r\n\t\t})\r\n\t}\r\n\r\n})();"]}